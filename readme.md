# Многофункциональный Telegram-бот на базе Gemini

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg?style=flat-square)](https://www.python.org/downloads/)
[![pyTelegramBotAPI](https://img.shields.io/badge/pyTelegramBotAPI-4.15.0+-brightgreen.svg?style=flat-square)](https://github.com/eternnoir/pyTelegramBotAPI)
[![Gemini API](https://img.shields.io/badge/Gemini_API-0.4.0+-orange.svg?style=flat-square)](https://ai.google.dev/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg?style=flat-square)](https://opensource.org/licenses/MIT)

## Описание проекта

Это асинхронный Telegram-бот, разработанный на Python с использованием библиотеки `pyTelegramBotAPI` и возможностей `Google Gemini API`. Бот предоставляет широкий спектр функций, от простого общения и ответов на вопросы до анализа изображений, перевода текста, создания кратких изложений, планирования доходов и установки напоминаний.

## Возможности бота

*   **Интеллектуальное общение:**  Ответы на вопросы, генерация текста на основе продвинутой языковой модели Google Gemini.
*   **Анализ изображений:**  Распознавание и описание содержимого изображений, предоставление справочной информации об объектах на фото.
*   **Перевод текста:**  Перевод текста на различные языки с помощью Gemini API (поддерживается выбор языка через меню).
*   **Изложение текста:**  Создание кратких и структурированных изложений из текста, веб-страниц (по URL) и документов (DOCX, PDF, TXT).
*   **План дохода:**  Генерация пошаговых планов для достижения финансовых целей на основе навыков, ресурсов и интересов пользователя.
*   **Установка напоминаний:**  Установка персональных напоминаний с указанием даты и времени, управление существующими напоминаниями.
*   **История диалога:**  Просмотр истории переписки с ботом за выбранную дату.
*   **Личный кабинет:**  Просмотр статистики использования бота, звания пользователя и текущих настроек.
*   **Настройки:**  Персонализация стиля общения бота и установка часового пояса пользователя для корректной работы напоминаний.
*   **Администрирование (для администратора бота):**
    *   Рассылка сообщений всем активным пользователям.
    *   Уведомления о новых пользователях.

## Технологии

*   **Python 3.10+:** Основной язык программирования.
*   **pyTelegramBotAPI (async):** Асинхронная библиотека для работы с Telegram Bot API.
*   **Google Gemini API:**  Для обработки естественного языка, анализа изображений и генерации контента.
*   **python-dotenv:**  Для управления конфигурацией через `.env` файлы.
*   **PyYAML:**  Для конфигурации логирования через YAML.
*   **APScheduler:**  Для планирования задач, в частности, для реализации напоминаний.
*   **sqlite3:**  Встроенная база данных SQLite для хранения пользовательских данных, истории сообщений и напоминаний.
*   **python-docx, PyPDF2:**  Для обработки документов форматов DOCX и PDF.
*   **requests, beautifulsoup4, lxml:** Для веб-скрейпинга (извлечения текста с веб-страниц).
*   **Pillow:**  Для обработки изображений.
*   **timezonefinder:**  Для определения часового пояса по координатам геолокации.

## Настройка и запуск

### Предварительные требования

*   **Python 3.10 или выше:** Убедитесь, что Python установлен в вашей системе.
*   **pip:** Менеджер пакетов Python, обычно устанавливается вместе с Python.

### Шаги по установке

1.  **Клонируйте репозиторий:**

    ```bash
    git clone [URL вашего репозитория]
    cd [директория репозитория]
    ```

2.  **Создайте и активируйте виртуальное окружение (рекомендуется):**

    ```bash
    python -m venv venv
    source venv/bin/activate  # для Linux/macOS
    venv\Scripts\activate  # для Windows
    ```

3.  **Установите зависимости проекта:**

    ```bash
    pip install -r requirements.txt
    ```

4.  **Настройте конфигурацию:**

    *   **Файл `.env`:**
        Создайте файл `.env` в корневой директории проекта и добавьте следующие переменные, заменив значения на свои:

        ```env
        BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
        GEMINI_API_KEY=YOUR_GOOGLE_GEMINI_API_KEY
        ADMIN_USER_ID=YOUR_TELEGRAM_ADMIN_USER_ID
        GEMINI_MODEL_NAME=gemini-2.0-flash-thinking-exp-01-21 # (Опционально, если хотите использовать другую модель)
        MAX_SUMMARIZE_CHARS=8000 # (Опционально, можно изменить лимит символов для изложения)
        ```

        Получите `BOT_TOKEN` у [BotFather](https://t.me/BotFather) в Telegram.
        Получите `GEMINI_API_KEY` в [Google AI Studio](https://makersuite.google.com/app/apikey).
        Укажите свой Telegram User ID в `ADMIN_USER_ID` для получения уведомлений и администрирования бота.

    *   **Файл `config/settings.py`:**
        Проверьте и при необходимости настройте параметры в `config/settings.py`, такие как `GEMINI_MODEL_NAME`, `MAX_SUMMARIZE_CHARS`, стили бота (`BOT_STYLES`), языки (`LANGUAGE_FLAGS`), и другие настройки.

    *   **Файл `config/logging.yaml`:**
        Настройте параметры логирования в `config/logging.yaml` в соответствии с вашими потребностями. Файлы логов будут сохраняться в директории `logs/`.

5.  **Настройка базы данных:**

    База данных SQLite (`bot_database.db`) будет создана автоматически при первом запуске бота в директории `database/`. Структура базы данных настраивается автоматически при запуске.

### Запуск бота

Запустите бота, выполнив следующую команду в терминале:

```bash
python main.py
```

После запуска бот начнет опрос серверов Telegram и будет готов к работе. Вы можете найти бота в Telegram по имени пользователя, указанному при создании бота через BotFather, и начать взаимодействие, отправив команду /start.
## Структура директорий
```
├── .env                     # Файл с переменными окружения
├── logger_config.py          # Конфигурация логирования
├── main.py                   # Основной файл запуска бота
├── requirements.txt          # Список зависимостей проекта
├── config/                   # Директория конфигурации
│   ├── logging.yaml          # Конфигурация логирования в YAML
│   ├── settings.py           # Настройки бота и API
│   └── __init__.py
├── database/                 # Директория базы данных
│   ├── bot_database.db       # Файл базы данных SQLite
│   ├── db_manager.py         # Модуль управления базой данных
│   └── __init__.py
├── features/                 # Директория функций бота
│   ├── personal_account.py   # Функции личного кабинета пользователя
│   ├── reminders.py          # Функции напоминаний
│   └── __init__.py
├── handlers/                 # Директория обработчиков сообщений и команд
│   ├── callback_handlers.py  # Обработчики callback-запросов (кнопок)
│   ├── command_handlers.py   # Обработчики команд (начинающихся с /)
│   ├── message_handlers.py   # Обработчики текстовых и других сообщений
│   └── __init__.py
├── logs/                     # Директория для логов (создается автоматически)
│   ├── ...                   # Файлы логов
├── services/                 # Директория сервисов
│   ├── gemini_service.py     # Сервис для взаимодействия с Gemini API
│   └── __init__.py
└── utils/                    # Директория вспомогательных утилит
    ├── analysis_helpers.py   # Утилиты для анализа текста
    ├── file_helpers.py       # Утилиты для работы с файлами (docx, pdf, txt)
    ├── markup_helpers.py     # Утилиты для создания клавиатур (markup)
    ├── text_helpers.py       # Утилиты для обработки текста
    ├── web_helpers.py        # Утилиты для работы с веб-контентом
    └── __init__.py
```

## Система логирования 
Логирование настроено с использованием библиотеки logging и конфигурационного файла config/logging.yaml. 
Логи разделены по разным файлам в директории logs/ для удобства отслеживания различных аспектов работы бота:
*   **bot.log, bot_app.log, bot_general.log, bot_other.log** - общие логи приложения бота.
*   **database.log** - логи, связанные с операциями базы данных.
*   **gemini_api.log** - логи запросов и ответов Gemini API.
*   **reminders.log** - логи, связанные с работой планировщика напоминаний.
*   **user_messages.log** - логи входящих сообщений от пользователей.
## Лицензия
* Этот проект лицензирован по лицензии MIT.
## Поддержка и обратная связь
Если у вас есть вопросы, предложения или вы обнаружили ошибки, пожалуйста, создайте issue в репозитории GitHub или свяжитесь со мной [kobaltmail@gmail.com].
## Удачи в использовании бота!
